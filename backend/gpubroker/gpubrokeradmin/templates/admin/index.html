{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - GPUBROKER Admin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;500;600;700&family=Geist+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'gpubrokeradmin/css/admin.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <script>
        // SECURITY: Immediate auth check - redirect BEFORE page renders
        (function() {
            const token = localStorage.getItem('admin_token') || sessionStorage.getItem('admin_token');
            if (!token) {
                window.location.replace('/admin/login/');
            }
        })();
    </script>
    <div class="admin-layout">
        <!-- Header -->
        <header class="admin-header">
            <a href="/admin/" class="admin-logo" style="font-weight: 700; letter-spacing: -0.03em;">GPUBROKER</a>
            
            <!-- Environment Toggle (Sandbox/Live) -->
            <div class="env-toggle" id="envToggle">
                <button class="env-btn sandbox" id="envSandbox" onclick="setEnv('sandbox')">Sandbox</button>
                <button class="env-btn live active" id="envLive" onclick="setEnv('live')">Live</button>
            </div>
            
            <nav class="nav-tabs">
                <button class="nav-tab active" data-section="dashboard" onclick="showSection('dashboard')">
                    <span class="material-symbols-rounded">dashboard</span>
                    <span class="nav-tab-label">Dashboard</span>
                </button>
                <button class="nav-tab" data-section="pods" onclick="showSection('pods')">
                    <span class="material-symbols-rounded">dns</span>
                    <span class="nav-tab-label">Pods</span>
                    <span class="nav-tab-count" id="navPodsCount">0</span>
                </button>
                <button class="nav-tab" data-section="customers" onclick="showSection('customers')">
                    <span class="material-symbols-rounded">group</span>
                    <span class="nav-tab-label">Clientes</span>
                    <span class="nav-tab-count" id="navCustomersCount">0</span>
                </button>
                <button class="nav-tab" data-section="billing" onclick="showSection('billing')">
                    <span class="material-symbols-rounded">payments</span>
                    <span class="nav-tab-label">Facturación</span>
                    <span class="nav-tab-count" id="navBillingCount">$0</span>
                </button>
                <a href="/admin/costs/" class="nav-tab" style="text-decoration: none;">
                    <span class="material-symbols-rounded">analytics</span>
                    <span class="nav-tab-label">Costos</span>
                </a>
            </nav>
            
            <div class="user-menu">
                <button class="btn btn-icon btn-ghost" onclick="openModal('alertsModal')">
                    <span class="material-symbols-rounded">notifications</span>
                </button>
                <button class="btn btn-icon btn-ghost" onclick="openModal('settingsModal')">
                    <span class="material-symbols-rounded">settings</span>
                </button>
                <div class="user-avatar" id="userAvatar" onclick="openModal('accountModal')" style="cursor: pointer;">A</div>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="admin-main">
            <!-- KPI Cards -->
            <section class="card-grid mb-lg animate-fade-in">
                <!-- Pods Card -->
                <div class="card kpi-card" onclick="openModal('podsModal')">
                    <div class="kpi-header">
                        <div>
                            <div class="kpi-value" id="podsCount">--</div>
                            <div class="kpi-label">Pods Activos</div>
                        </div>
                        <div class="kpi-icon">
                            <span class="material-symbols-rounded">dns</span>
                        </div>
                    </div>
                    <div class="kpi-change positive">
                        <span class="material-symbols-rounded" style="font-size: 14px;">trending_up</span>
                        <span id="podsChange">+0 hoy</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 60%;" id="podsProgress"></div>
                    </div>
                </div>
                
                <!-- Revenue Card -->
                <div class="card kpi-card" onclick="openModal('revenueModal')">
                    <div class="kpi-header">
                        <div>
                            <div class="kpi-value" id="revenueAmount">$--</div>
                            <div class="kpi-label">Este Mes</div>
                        </div>
                        <div class="kpi-icon">
                            <span class="material-symbols-rounded">payments</span>
                        </div>
                    </div>
                    <div class="kpi-change positive">
                        <span class="material-symbols-rounded" style="font-size: 14px;">trending_up</span>
                        <span id="revenueChange">+0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 75%;" id="revenueProgress"></div>
                    </div>
                </div>
                
                <!-- Customers Card -->
                <div class="card kpi-card" onclick="openModal('customersModal')">
                    <div class="kpi-header">
                        <div>
                            <div class="kpi-value" id="customersCount">--</div>
                            <div class="kpi-label">Clientes</div>
                        </div>
                        <div class="kpi-icon">
                            <span class="material-symbols-rounded">group</span>
                        </div>
                    </div>
                    <div class="kpi-change positive">
                        <span class="material-symbols-rounded" style="font-size: 14px;">trending_up</span>
                        <span id="customersChange">+0 nuevos</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 45%;" id="customersProgress"></div>
                    </div>
                </div>
                
                <!-- Alerts Card -->
                <div class="card kpi-card" onclick="openModal('alertsModal')">
                    <div class="kpi-header">
                        <div>
                            <div class="kpi-value" id="alertsCount">--</div>
                            <div class="kpi-label">Alertas</div>
                        </div>
                        <div class="kpi-icon" style="background: #FEE2E2;">
                            <span class="material-symbols-rounded" style="color: var(--color-error);">warning</span>
                        </div>
                    </div>
                    <div class="kpi-change negative" id="alertsStatus">
                        <span>Revisar</span>
                    </div>
                </div>
            </section>
            
            <!-- Charts Row -->
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--space-lg); margin-bottom: var(--space-lg);">
                <!-- Revenue Chart -->
                <div class="chart-container animate-fade-in" style="animation-delay: 100ms;">
                    <div class="chart-header">
                        <h3 class="chart-title">Ingresos Mensuales</h3>
                        <div class="nav-pills" style="padding: 2px;">
                            <button class="nav-pill active" style="padding: 4px 12px; font-size: 12px;">Mes</button>
                            <button class="nav-pill" style="padding: 4px 12px; font-size: 12px;">Año</button>
                        </div>
                    </div>
                    <div style="position: relative; height: 200px; width: 100%;">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
                
                <!-- Distribution Chart -->
                <div class="chart-container animate-fade-in" style="animation-delay: 200ms;">
                    <div class="chart-header">
                        <h3 class="chart-title">Distribución de Planes</h3>
                    </div>
                    <div style="position: relative; height: 200px; width: 100%;">
                        <canvas id="distributionChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Activity Feed -->
            <div class="chart-container animate-fade-in" style="animation-delay: 300ms;">
                <div class="chart-header">
                    <h3 class="chart-title">Actividad Reciente</h3>
                    <button class="btn btn-ghost" style="font-size: 12px;">
                        Ver todo <span class="material-symbols-rounded" style="font-size: 14px;">arrow_forward</span>
                    </button>
                </div>
                <div class="activity-feed" id="activityFeed">
                    <!-- Populated by JS -->
                </div>
            </div>
        </main>
    </div>

    <!-- Pods Modal -->
    <div class="modal-overlay" id="podsModal">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title"><span class="material-symbols-rounded" style="color: var(--color-success);">dns</span> Pods Activos</h3>
                <button class="modal-close" onclick="closeModal('podsModal')">
                    <span class="material-symbols-rounded">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Pod ID</th>
                                <th>Cliente</th>
                                <th>Plan</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="podsTableBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('podsModal')">Cerrar</button>
                <button class="btn btn-primary" onclick="openFullModal('pods')">Ver Todos</button>
            </div>
        </div>
    </div>
    
    <!-- Revenue Modal -->
    <div class="modal-overlay" id="revenueModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title"><span class="material-symbols-rounded" style="color: var(--color-accent);">payments</span> Ingresos del Mes</h3>
                <button class="modal-close" onclick="closeModal('revenueModal')">
                    <span class="material-symbols-rounded">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 3rem; font-weight: 700;" id="modalRevenueAmount">$0.00</div>
                    <div style="color: var(--color-muted);">Total este mes</div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 24px;">
                    <div style="text-align: center; padding: 16px; background: var(--color-bg); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: 600;" id="modalTxCount">0</div>
                        <div style="font-size: 12px; color: var(--color-muted);">Transacciones</div>
                    </div>
                    <div style="text-align: center; padding: 16px; background: var(--color-bg); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: 600;" id="modalAvgOrder">$0</div>
                        <div style="font-size: 12px; color: var(--color-muted);">Promedio</div>
                    </div>
                    <div style="text-align: center; padding: 16px; background: var(--color-bg); border-radius: 12px;">
                        <div style="font-size: 1.5rem; font-weight: 600; color: var(--color-success);" id="modalGrowth">+0%</div>
                        <div style="font-size: 12px; color: var(--color-muted);">vs mes anterior</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('revenueModal')">Cerrar</button>
                <button class="btn btn-primary" onclick="openFullModal('billing')">Ver Facturación</button>
            </div>
        </div>
    </div>
    
    <!-- Customers Modal -->
    <div class="modal-overlay" id="customersModal">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title"><span class="material-symbols-rounded">group</span> Clientes Recientes</h3>
                <button class="modal-close" onclick="closeModal('customersModal')">
                    <span class="material-symbols-rounded">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="customersListModal" class="activity-feed">
                    <!-- Populated by JS -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('customersModal')">Cerrar</button>
                <button class="btn btn-primary" onclick="openFullModal('customers')">Ver Todos</button>
            </div>
        </div>
    </div>
    
    <!-- Alerts Modal -->
    <div class="modal-overlay" id="alertsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title"><span class="material-symbols-rounded" style="color: var(--color-warning);">warning</span> Alertas del Sistema</h3>
                <button class="modal-close" onclick="closeModal('alertsModal')">
                    <span class="material-symbols-rounded">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="alertsList" class="activity-feed">
                    <!-- Populated by JS -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeModal('alertsModal')">Entendido</button>
            </div>
        </div>
    </div>

    <!-- Activity Detail Modal -->
    <div class="modal-overlay" id="activityDetailModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title"><span class="material-symbols-rounded" id="activityDetailIcon">info</span> Detalle de Actividad</h3>
                <button class="modal-close" onclick="closeModal('activityDetailModal')">
                    <span class="material-symbols-rounded">close</span>
                </button>
            </div>
            <div class="modal-body" id="activityDetailBody">
                <!-- Populated by JS -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('activityDetailModal')">Cerrar</button>
                <button class="btn btn-primary" id="activityDetailAction" style="display: none;">Ver Más</button>
            </div>
        </div>
    </div>

    <!-- PODS Full-Screen Modal -->
    <div class="modal-overlay" id="podsFullModal">
        <div class="modal modal-fullscreen">
            <div class="modal-header">
                <h3 class="modal-title"><span class="material-symbols-rounded">dns</span> Gestión de Pods</h3>
                <button class="modal-close" onclick="closeFullModal('pods')">
                    <span class="material-symbols-rounded">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="master-detail">
                    <div class="master-list">
                        <div class="master-list-header">
                            <div class="search-bar" style="max-width: 100%;">
                                <span class="material-symbols-rounded" style="color: var(--color-muted);">search</span>
                                <input type="text" placeholder="Buscar pod..." id="searchPodsModal">
                            </div>
                        </div>
                        <div class="master-list-items" id="podsListItems">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <div class="detail-panel" id="podDetailPanel" style="display: flex; flex-direction: column; gap: 12px;">
                        <!-- Pod Header Card -->
                        <div class="card" id="podHeaderCard" style="background: linear-gradient(135deg, #dcfce7 0%, #f0fdf4 100%); border-color: #bbf7d0; padding: 12px 16px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="width: 40px; height: 40px; border-radius: 50%; background: #22c55e; color: white; display: flex; align-items: center; justify-content: center;">
                                    <span class="material-symbols-rounded" style="font-size: 20px;">dns</span>
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-size: 1.1rem; font-weight: 700; font-family: var(--font-mono);" id="detailPodId">pod-xxxxx</div>
                                    <div style="font-size: 0.8rem; color: #15803d;" id="detailPodRegion">us-east-1</div>
                                </div>
                                <span class="status-badge running" id="podStatusBadge">RUNNING</span>
                            </div>
                        </div>

                        <!-- 3-Column Main Grid -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                            <!-- Col 1: Pod Info -->
                            <div class="card" style="padding: 12px;">
                                <div style="font-size: 0.7rem; font-weight: 600; color: var(--color-muted); text-transform: uppercase; margin-bottom: 8px;">Información del Pod</div>
                                <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--color-border); font-size: 0.85rem;">
                                    <span style="color: var(--color-muted);">IP Pública</span>
                                    <span style="font-weight: 500; font-family: var(--font-mono);" id="detailPodIP">--</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--color-border); font-size: 0.85rem;">
                                    <span style="color: var(--color-muted);">Creado</span>
                                    <span style="font-weight: 500;" id="detailPodCreated">--</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 0.85rem;">
                                    <span style="color: var(--color-muted);">Región</span>
                                    <span style="font-weight: 500;">us-east-1</span>
                                </div>
                            </div>

                            <!-- Col 2: Customer Info -->
                            <div class="card" style="padding: 12px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 0.7rem; font-weight: 600; color: var(--color-muted); text-transform: uppercase;">Cliente</span>
                                    <span class="cross-ref" style="font-size: 0.75rem;" onclick="openFullModal('customers')">Ver →</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--color-border); font-size: 0.85rem;">
                                    <span style="color: var(--color-muted);">Email</span>
                                    <span style="font-weight: 500;" id="detailPodEmail">--</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--color-border); font-size: 0.85rem;">
                                    <span style="color: var(--color-muted);">Plan</span>
                                    <span style="font-weight: 500;" id="detailPodPlan">--</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 0.85rem;">
                                    <span style="color: var(--color-muted);">RUC</span>
                                    <span style="font-weight: 500; font-family: var(--font-mono);" id="detailPodRUC">--</span>
                                </div>
                            </div>

                            <!-- Col 3: Billing -->
                            <div class="card" style="padding: 12px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 0.7rem; font-weight: 600; color: var(--color-muted); text-transform: uppercase;">Facturación</span>
                                    <span class="cross-ref" style="font-size: 0.75rem;" onclick="openFullModal('billing')">Ver →</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--color-border); font-size: 0.85rem;">
                                    <span style="color: var(--color-muted);">Último Pago</span>
                                    <span style="font-weight: 600; color: var(--color-success);">$49.00</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid var(--color-border); font-size: 0.85rem;">
                                    <span style="color: var(--color-muted);">Método</span>
                                    <span style="font-weight: 500;">PayPal</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 6px 0; font-size: 0.85rem;">
                                    <span style="color: var(--color-muted);">Estado</span>
                                    <span class="status-badge running" style="font-size: 10px;">PAGADO</span>
                                </div>
                            </div>
                        </div>

                        <!-- AWS Metrics -->
                        <div class="card" style="padding: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span style="font-size: 0.7rem; font-weight: 600; color: var(--color-muted); text-transform: uppercase;">Rendimiento AWS</span>
                                <span class="status-badge running" style="font-size: 9px;">EN VIVO</span>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
                                <div style="text-align: center; padding: 10px; background: var(--color-bg); border-radius: 6px;">
                                    <div style="font-size: 1.25rem; font-weight: 700;" id="detailPodCPU">0%</div>
                                    <div style="font-size: 0.65rem; color: var(--color-muted); text-transform: uppercase;">CPU</div>
                                </div>
                                <div style="text-align: center; padding: 10px; background: var(--color-bg); border-radius: 6px;">
                                    <div style="font-size: 1.25rem; font-weight: 700;" id="detailPodMemory">0%</div>
                                    <div style="font-size: 0.65rem; color: var(--color-muted); text-transform: uppercase;">Memoria</div>
                                </div>
                                <div style="text-align: center; padding: 10px; background: var(--color-bg); border-radius: 6px;">
                                    <div style="font-size: 1.25rem; font-weight: 700; color: var(--color-success);" id="detailPodCost">$0.00</div>
                                    <div style="font-size: 0.65rem; color: var(--color-muted); text-transform: uppercase;">Costo</div>
                                </div>
                                <div style="text-align: center; padding: 10px; background: var(--color-bg); border-radius: 6px;">
                                    <div style="font-size: 1.25rem; font-weight: 700;" id="detailPodUptime">0h</div>
                                    <div style="font-size: 0.65rem; color: var(--color-muted); text-transform: uppercase;">Uptime</div>
                                </div>
                            </div>
                        </div>

                        <!-- Token Usage -->
                        <div class="card" style="padding: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                                <span style="font-size: 0.7rem; font-weight: 600; color: var(--color-muted); text-transform: uppercase;">Uso de Tokens</span>
                                <span style="font-size: 0.8rem;"><span id="detailTokensUsed">0</span> / <span id="detailTokensLimit">10,000</span></span>
                            </div>
                            <div class="progress-bar" style="height: 6px;">
                                <div class="progress-fill" style="width: 0%;" id="detailTokensProgress"></div>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button class="btn btn-primary" id="btnStartPod" onclick="startPod()">
                                <span class="material-symbols-rounded">play_arrow</span> Iniciar
                            </button>
                            <button class="btn btn-secondary" id="btnRestartPod" onclick="restartPod()">
                                <span class="material-symbols-rounded">refresh</span> Reiniciar
                            </button>
                            <button class="btn btn-secondary" id="btnStopPod" onclick="stopPod()">
                                <span class="material-symbols-rounded">pause</span> Detener
                            </button>
                            <button class="btn btn-secondary" style="background: var(--color-error); color: white;" id="btnDestroyPod" onclick="destroyPod()">
                                <span class="material-symbols-rounded">delete_forever</span> Destruir
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CUSTOMERS Full-Screen Modal -->
    <div class="modal-overlay" id="customersFullModal">
        <div class="modal modal-fullscreen">
            <div class="modal-header">
                <h3 class="modal-title"><span class="material-symbols-rounded">group</span> Clientes</h3>
                <button class="modal-close" onclick="closeFullModal('customers')">
                    <span class="material-symbols-rounded">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="master-detail">
                    <div class="master-list">
                        <div class="master-list-header">
                            <div class="search-bar" style="max-width: 100%;">
                                <span class="material-symbols-rounded" style="color: var(--color-muted);">search</span>
                                <input type="text" placeholder="Buscar cliente..." id="searchCustomersModal">
                            </div>
                        </div>
                        <div class="master-list-items" id="customersListItems">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <div class="detail-panel" id="customerDetailPanel">
                        <div class="detail-card">
                            <div class="detail-card-header">
                                <span class="detail-card-title">Perfil del Cliente</span>
                                <span class="status-badge running" id="customerStatusBadge">ACTIVO</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                                <div class="user-avatar" style="width: 64px; height: 64px; font-size: 24px;" id="customerAvatar">A</div>
                                <div>
                                    <h3 id="detailCustomerName">Cliente</h3>
                                    <p style="color: var(--color-muted);" id="detailCustomerEmail">email@example.com</p>
                                </div>
                            </div>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <div class="detail-item-label">RUC</div>
                                    <div class="detail-item-value mono" id="detailCustomerRUC">--</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">Plan</div>
                                    <div class="detail-item-value" id="detailCustomerPlan">--</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">Registro</div>
                                    <div class="detail-item-value" id="detailCustomerCreated">--</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-item-label">Último Acceso</div>
                                    <div class="detail-item-value">Hace 5 min</div>
                                </div>
                            </div>
                        </div>
                        <div class="detail-card">
                            <div class="detail-card-header">
                                <span class="detail-card-title">Pod Asociado</span>
                                <span class="cross-ref" onclick="openFullModal('pods')">
                                    <span class="material-symbols-rounded" style="font-size: 16px;">open_in_new</span>
                                    Ver Pod
                                </span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Pod ID</span>
                                <span class="data-value mono" id="detailCustomerPodId">--</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Estado</span>
                                <span class="status-badge running">RUNNING</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">URL</span>
                                <span class="data-value mono" id="detailCustomerPodUrl">--</span>
                            </div>
                        </div>
                        <div class="detail-card">
                            <div class="detail-card-header">
                                <span class="detail-card-title">Historial de Pagos</span>
                                <span class="cross-ref" onclick="openFullModal('billing')">
                                    <span class="material-symbols-rounded" style="font-size: 16px;">open_in_new</span>
                                    Ver Todos
                                </span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Total Pagado</span>
                                <span class="data-value" style="font-size: 1.25rem; font-weight: 700;" id="detailCustomerTotalPaid">$0.00</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Último Pago</span>
                                <span class="data-value" id="detailCustomerLastPayment">--</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Próximo Cobro</span>
                                <span class="data-value" id="detailCustomerNextPayment">--</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-secondary">
                                <span class="material-symbols-rounded">mail</span> Enviar Email
                            </button>
                            <button class="btn btn-primary">
                                <span class="material-symbols-rounded">edit</span> Editar Cliente
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- BILLING Full-Screen Modal -->
    <div class="modal-overlay" id="billingFullModal">
        <div class="modal modal-fullscreen">
            <div class="modal-header">
                <h3 class="modal-title"><span class="material-symbols-rounded">payments</span> Facturación</h3>
                <button class="modal-close" onclick="closeFullModal('billing')">
                    <span class="material-symbols-rounded">close</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- KPI Summary -->
                <div class="card-grid mb-lg">
                    <div class="card kpi-card" style="cursor: default;">
                        <div class="kpi-value" id="billingTotalRevenue">$0</div>
                        <div class="kpi-label">Ingresos Totales</div>
                    </div>
                    <div class="card kpi-card" style="cursor: default;">
                        <div class="kpi-value" id="billingTxCount">0</div>
                        <div class="kpi-label">Transacciones</div>
                    </div>
                    <div class="card kpi-card" style="cursor: default;">
                        <div class="kpi-value" id="billingAvgOrder">$0</div>
                        <div class="kpi-label">Promedio</div>
                    </div>
                    <div class="card kpi-card" style="cursor: default;">
                        <div class="kpi-value" style="color: var(--color-success);" id="billingGrowth">+0%</div>
                        <div class="kpi-label">vs Mes Anterior</div>
                    </div>
                </div>

                <div class="master-detail">
                    <div class="master-list">
                        <div class="master-list-header">
                            <div class="search-bar" style="max-width: 100%;">
                                <span class="material-symbols-rounded" style="color: var(--color-muted);">search</span>
                                <input type="text" placeholder="Buscar transacción..." id="searchBillingModal">
                            </div>
                        </div>
                        <div class="master-list-items" id="billingListItems">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <div class="detail-panel" id="billingDetailPanel">
                        <div class="detail-card">
                            <div style="text-align: center; padding: 24px;">
                                <div style="font-size: 3rem; font-weight: 700; color: var(--color-success);" id="detailTxAmount">$0.00</div>
                                <div style="color: var(--color-muted);">USD</div>
                            </div>
                        </div>
                        <div class="detail-card">
                            <div class="detail-card-header">
                                <span class="detail-card-title">Detalles de Transacción</span>
                                <span class="status-badge running" id="txStatusBadge">COMPLETADO</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Transaction ID</span>
                                <span class="data-value mono" id="detailTxId">--</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Order ID</span>
                                <span class="data-value mono" id="detailOrderId">--</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Fecha</span>
                                <span class="data-value" id="detailTxDate">--</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Método</span>
                                <span class="data-value" id="detailTxMethod">PayPal</span>
                            </div>
                        </div>
                        <div class="detail-card">
                            <div class="detail-card-header">
                                <span class="detail-card-title">Cliente</span>
                                <span class="cross-ref" onclick="openFullModal('customers')">
                                    <span class="material-symbols-rounded" style="font-size: 16px;">open_in_new</span>
                                    Ver Cliente
                                </span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Nombre</span>
                                <span class="data-value" id="detailTxCustomer">--</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Email</span>
                                <span class="data-value" id="detailTxEmail">--</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Plan</span>
                                <span class="data-value" id="detailTxPlan">--</span>
                            </div>
                        </div>
                        <div class="detail-card">
                            <div class="detail-card-header">
                                <span class="detail-card-title">Pod Asociado</span>
                                <span class="cross-ref" onclick="openFullModal('pods')">
                                    <span class="material-symbols-rounded" style="font-size: 16px;">open_in_new</span>
                                    Ver Pod
                                </span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Pod ID</span>
                                <span class="data-value mono" id="detailTxPodId">--</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Estado</span>
                                <span class="status-badge running">RUNNING</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-secondary">
                                <span class="material-symbols-rounded">receipt</span> Descargar Recibo
                            </button>
                            <button class="btn btn-primary" onclick="resendReceipt()">
                                <span class="material-symbols-rounded">mail</span> Reenviar Email
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ACCOUNT Modal -->
    <div class="modal-overlay" id="accountModal">
        <div class="modal" style="max-width: 480px;">
            <div class="modal-header">
                <h3 class="modal-title"><span class="material-symbols-rounded">person</span> Mi Cuenta</h3>
                <button class="modal-close" onclick="closeModal('accountModal')">
                    <span class="material-symbols-rounded">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 24px;">
                    <div class="user-avatar" style="width: 80px; height: 80px; font-size: 32px; margin: 0 auto 16px;" id="accountAvatar">A</div>
                    <h3 id="accountName">Admin User</h3>
                    <p style="color: var(--color-muted);" id="accountEmail">admin@gpubroker.com</p>
                    <span class="status-badge running" id="accountRole">ADMIN</span>
                </div>
                <div class="detail-card" style="margin-bottom: 16px;">
                    <div class="data-row">
                        <span class="data-label">Último Acceso</span>
                        <span class="data-value">Ahora</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Sesiones Activas</span>
                        <span class="data-value">1</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">2FA</span>
                        <span class="status-badge warning">DESACTIVADO</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="flex-direction: column; gap: 8px;">
                <button class="btn btn-secondary" style="width: 100%;" onclick="openModal('settingsModal'); closeModal('accountModal');">
                    <span class="material-symbols-rounded">settings</span> Configuración
                </button>
                <button class="btn btn-primary" style="width: 100%; background: var(--color-error);" onclick="logout()">
                    <span class="material-symbols-rounded">logout</span> Cerrar Sesión
                </button>
            </div>
        </div>
    </div>

    <!-- SETTINGS Modal -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title"><span class="material-symbols-rounded">settings</span> Configuración</h3>
                <button class="modal-close" onclick="closeModal('settingsModal')">
                    <span class="material-symbols-rounded">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="detail-card" style="margin-bottom: 16px;">
                    <div class="detail-card-header">
                        <span class="detail-card-title">Configuración de Facturación</span>
                    </div>
                    <div class="form-group" style="margin-top: 16px;">
                        <label class="form-label">Moneda</label>
                        <select class="form-input" id="billingCurrency">
                            <option value="USD" selected>USD - Dólar Americano</option>
                            <option value="EUR">EUR - Euro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Método de Pago Principal</label>
                        <select class="form-input" id="paymentMethod">
                            <option value="paypal" selected>PayPal</option>
                            <option value="stripe">Stripe</option>
                            <option value="payphone">PayPhone</option>
                        </select>
                    </div>
                </div>
                <div class="detail-card">
                    <div class="detail-card-header">
                        <span class="detail-card-title">Notificaciones</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Nuevos Pagos</span>
                        <label class="switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Alertas de Sistema</span>
                        <label class="switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="data-row">
                        <span class="data-label">Nuevos Clientes</span>
                        <label class="switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('settingsModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveSettings()">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="admin-footer">
        <p>© 2025 GPUBROKER. Todos los derechos reservados.</p>
        <p>Desarrollado por <a href="https://www.somatech.dev" target="_blank" rel="noopener">SOMATECH</a></p>
    </footer>
    
    <script src="{% static 'gpubrokeradmin/js/admin.js' %}"></script>
</body>
</html>
